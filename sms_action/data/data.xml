<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- sms.receive_sms -->

        <record model="ir.actions.server" id="event_registration">
            <field name="name">SMS register attendee</field>
            <field name="model_id" ref="model_sms_receive_sms"/>
            <field name="state">code</field>
            <field name="code">
ticket_name, attendee_names = record.message.split('\n', maxsplit=1)
t = env['event.event.ticket'].search([('name', '=', ticket_name)])
t = t.filtered(lambda r: r.event_id.date_begin > datetime.datetime.now())
ticket = t.sorted(key=lambda r: r.event_id.date_begin)[0]
event = ticket.event_id

for name in attendee_names.split('\n'):
    env['event.registration'].create({
        'name': name,
        'event_id': event.id,
        'event_ticket_id': ticket.id,
        'state': 'open',
    })

# send feedback

            </field>
        </record>

    </data>
</odoo>
